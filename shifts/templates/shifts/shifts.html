{% extends "base.html" %}
{% load i18n %}
{% block body_class %}{{ block.super }} home{% endblock %}

{% block content %}

<h1>Volunteer Shifts</h1>

<section id="shiftgrid">

{% regroup grouped_shifts by date as shifts_by_dates %}
{% for shifts_on_date in shifts_by_dates %}
    {% ifchanged %}<h2><span>{{ shifts_on_date.grouper|date:"l, M jS, Y" }}</span></h2>{% endifchanged %}
    
    {% regroup shifts_on_date.list by department as shifts_by_departments %}
    {% for shifts_in_department in shifts_by_departments %}
        <table width="100%">
            <tr>
                <th width="11%" class="department">{{ shifts_in_department.grouper }}</th>
                <td width="89%">
                {% regroup shifts_in_department.list by length as shifts_by_lengths %}
                {% for length in shifts_by_lengths %}
                    <table width="98%">
                        <tr class="hours">
                            <th>12a</th><th>1a</th><th>2a</th>
                            <th>3a</th><th>4a</th><th>5a</th>
                            <th>6a</th><th>7a</th><th>8a</th>
                            <th>9a</th><th>10a</th><th>11a</th>
                            <th>12p</th><th>1p</th><th>2p</th>
                            <th>3p</th><th>4p</th><th>5p</th>
                            <th>6p</th><th>7p</th><th>8p</th>
                            <th>9p</th><th>10p</th><th>11p</th>
                        </tr>
                        <tr>
                            {% for row in length.list %}
                                {% for cell in row.tabular %}
                                <td class="{{ cell.class }}" colspan="{{ cell.columns }}">
                                    {% if cell.has_shifts %}
                                        {% for shift in cell.shifts %}
                                            {% if shift.owner %}
                                                <span><a class="claimed-shift" href="/shifts/release/{{ shift.id }}" alt="{{ shift.owner }} @ {{ shift.start_at }}" title="{{ shift.owner }} @ {{ shift.start_at }}">{{ shift.owner|stringformat:"s"|slice:":6" }}..</a></span>
                                            {% else %}
                                                <span><a class="open-shift" href="/shifts/claim/{{ shift.id }}" alt="{{ shift.start_at }}" title="{{ shift.start_at }}">o p e n</a></span>
                                            {% endif %}                                        
                                        {% endfor %}                                    
                                    {% endif %}
                                </td>
                                {% endfor %}
                            {% endfor %}

                        </tr>
                        <tr class="bottom"><th colspan="24"></th></tr>
                    </table>
                {% endfor %}
                </td>
            </tr>
        </table>
    {% endfor %}
    <hr class="close" />
{% endfor %}




</section>    
{% endblock %}

