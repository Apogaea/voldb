{% extends "base.html" %}
{% load i18n %}
{% block body_class %}{{ block.super }} home{% endblock %}

{% block content %}

<h1>Volunteer Shifts</h1>

<section id="shiftgrid">

{% verbatim %}
<script id="claim-modal" type="text/x-handlebars-template">
  <form class="claim-shift-modal" action="/api/shifts/{{shift}}/" method="post">
      <p>
        {{#if owner}}
            Would you like to <b>claim</b> the following shift?
        {{else}}
            Would you like to <b>release</b> this shift for others?
        {{/if}}
      </p>
      <blockquote>
        <b>{{department}}</b><br />
        {{start}}<br />
        Shift Length: <b>{{ shift_length }}</b> hours<br />
      </blockquote>
      <ul class="errors">
      </ul>
      {{#if restricted}}
          <label for="verification_code">Secret Code</label>
          <input type="text" name="verification_code">
      {{/if}}
      <input type="hidden" name="owner" value="{{owner}}">
      <button type="submit">{{#if owner}}Cliam{{else}}Release{{/if}} Shift</button>
      <button type="button" class="cancel">Cancel</button>
  </form>
</script>
{% endverbatim %}

{% regroup grouped_shifts by date as shifts_by_dates %}
{% for shifts_on_date in shifts_by_dates %}
    {% ifchanged %}<h2><span>{{ shifts_on_date.grouper|date:"l, M jS, Y" }}</span></h2>{% endifchanged %}
    
    {% regroup shifts_on_date.list by department as shifts_by_departments %}
    {% for shifts_in_department in shifts_by_departments %}
        <table width="100%">
            <tr>
                <th width="11%" class="department">{{ shifts_in_department.grouper }}</th>
                <td width="89%">
                {% regroup shifts_in_department.list by length as shifts_by_lengths %}
                {% for length in shifts_by_lengths %}
                    <table width="98%">
                        <tr class="hours">
                            <th>12a</th><th>1a</th><th>2a</th>
                            <th>3a</th><th>4a</th><th>5a</th>
                            <th>6a</th><th>7a</th><th>8a</th>
                            <th>9a</th><th>10a</th><th>11a</th>
                            <th>12p</th><th>1p</th><th>2p</th>
                            <th>3p</th><th>4p</th><th>5p</th>
                            <th>6p</th><th>7p</th><th>8p</th>
                            <th>9p</th><th>10p</th><th>11p</th>
                        </tr>
                        {% for row in length.list %}
                            <tr>
                                {% for cell in row.tabular %}
                                    <td class="{{ cell.classes }}" colspan="{{ cell.columns }}">
                                        {% if cell.shift %}
                                        <a id="shift-button-{{ cell.shift.pk }}" 
                                           alt=""
                                           title="{{ cell.shift.department }} @ {{ cell.shift.start_time|date:"l, n/j @ h:ia" }} for {{ cell.shift.shift_length }} hours"
                                           class="shift-toggle {% if cell.shift.owner %}  claimed-shift {% if user.is_authenticated and user.pk != cell.shift.owner.pk %} locked {} {% endif %} {% else %} open-shift {% endif %}" 
                                           href="#" 
                                           data-shift="{{ cell.shift.pk }}" 
                                           data-restricted="{{ cell.shift.requires_code|yesno:'true,false' }}" 
                                           data-owner="{{ cell.shift.owner|default:'null' }}" 
                                           data-department="{{ cell.shift.department }}" 
                                           data-start="{{ cell.shift.start_time|date:"l, n/j @ h:ia" }}" 
                                           data-shift-length="{{ cell.shift.shift_length }}">
                                                {% if cell.shift.owner %}
                                                    {{ cell.shift }}
                                                {% else %}
                                                    o p e n
                                                {% endif %}
                                            </a>
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        <tr class="bottom"><th colspan="24"></th></tr>
                    </table>
                {% endfor %}
                </td>
            </tr>
        </table>
    {% endfor %}
    <hr class="close" />
{% endfor %}




</section>    
{% endblock %}

